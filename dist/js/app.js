function addClass(e,t){e.classList.add(t)}function createElem(e,t,r){const a=document.createElement(e);return t.appendChild(a),r&&addClass(a,r),a}function setBackButtonEnabled(e){const t=document.querySelector("#corner-content_1"),r=document.querySelector("#corner-content_2"),a=document.querySelector("#list"),n=document.querySelector("#viewer");primary.setAttribute("style","opacity: 0"),e?(r.classList.remove("disabled"),t.classList.add("disabled"),a.setAttribute("style","display: none"),n.setAttribute("style","display: block")):(r.classList.add("disabled"),t.classList.remove("disabled"),a.setAttribute("style","display: block"),n.setAttribute("style","display: none"))}function renderListItem(e){var t=createElem("div",list);0==e.read&&addClass(t,"unread");createElem("div",t,"unread-dot");var r=e.author,a=createElem("img",t,"avatar");r.avatar?a.setAttribute("src",r.avatar):a.setAttribute("src","media/user.png");var n=createElem("div",t,"checkbox"),i=createElem("img",n);i.setAttribute("src","media/Check_mark.png");var s=createElem("div",t,"main-part"),c=createElem("div",s,"name-and-special"),o=createElem("h3",c);o.innerHTML=r.name+" "+r.surname;var l=createElem("div",c,"special"),d=createElem("img",l,"bookmark_icon");d.setAttribute("src","media/Bookmark.png"),1==e.bookmark?addClass(d,"enabled"):d.setAttribute("src","media/Bookmark_Empty.png");var u=createElem("img",l,"important_icon");u.setAttribute("src","media/Important.png"),1==e.important&&addClass(u,"enabled");var m=createElem("div",s,"compressed-contents"),p=createElem("h3",m,"listed-title");p.innerHTML=e.title;var g=createElem("h3",m,"listed-content");g.innerHTML=e.text;var b=createElem("div",t,"categories");if(e.doc){var y=createElem("img",b,"doc");y.setAttribute("src","media/Attachment.png")}if(e.flag){y=createElem("img",b);"Регистрации"==e.flag&&y.setAttribute("src","media/Cat_Registration.png"),"Штрафы и налоги"==e.flag&&y.setAttribute("src","media/Cat_Pay.png"),"Заказы"==e.flag&&y.setAttribute("src","media/Cat_Orders.png"),"Финансы"==e.flag&&y.setAttribute("src","media/Cat_Finance.png"),"Путешествия"==e.flag&&y.setAttribute("src","media/Cat_Travel.png"),"Билеты"==e.flag&&y.setAttribute("src","media/Cat_Tickets.png")}var h=createElem("h4",t,"listed-date");h.innerHTML=getDisplayDate(e.date).replace("/^0+/",""),s.addEventListener("click",()=>renderEmail(e.date))}function getDisplayDate(e){var t=new Date;if(t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),compDate=new Date(e),diff=t.getTime()-compDate.getTime(),compDate.getTime()==t.getTime())return"Сегодня, в "+compDate.getHours()+":"+compDate.getMinutes();if(diff<=864e5)return"Вчера, в "+compDate.getHours()+":"+compDate.getMinutes();var r=compDate.toDateString().split(" "),a=(r[0],r[1]),n=r[2],i=r[3],s="",c=(new Date).getFullYear;c!==i&&(s=", "+i);var o=n+" "+a+s;return o=o.replace("Jan","января").replace("Feb","Февраля").replace("Mar","Марта").replace("Apr","Апреля").replace("May","Мая").replace("Jun","Июня").replace("Jul","Июля").replace("Aug","Августа").replace("Sep","Сентября").replace("Oct","Октября").replace("Nov","Ноября").replace("Dec","Декабря"),o}function renderEmail(e){setBackButtonEnabled(!0);http.open("GET","/api/get_email_by_date/"+e);http.send(),http.onreadystatechange=function(){if(4==this.readyState&&200==this.status){setTimeout(()=>{primary.setAttribute("style","opacity: 1")},500);const a=JSON.parse(http.response)[0],n=document.querySelector(".title"),i=document.querySelector(".flag"),s=document.querySelector(".flag_icon"),c=document.querySelector(".dot"),o=document.querySelector(".extra > .avatar"),l=document.querySelector(".name"),d=document.querySelector(".date"),u=document.querySelector(".recipients"),m=document.querySelector(".media"),p=document.querySelector(".download"),g=document.querySelector(".content");n.innerHTML=a.title,a.author.avatar?o.setAttribute("src",a.author.avatar):o.setAttribute("src","media/user.png"),l.innerHTML=a.author.name+" "+a.author.surname,d.innerHTML=getDisplayDate(a.date);var e=[];if(a.to.forEach(t=>{e.push(t.name+" "+t.surname)}),a.to.length>4?u.innerHTML=a.to.length+" получателей: "+e.join(", "):a.to.length>1?u.innerHTML=a.to.length+" получателя: "+e.join(", "):u.innerHTML="Получатель: "+e.join(""),m.innerHTML="",a.doc){var t=a.doc.img;if(t){var r="1 файл";if("string"==typeof t){const e=createElem("img",m);e.setAttribute("src",t)}else r=t.length>4?t.length+" файлов":t.length+" файла",t.forEach(e=>{const t=createElem("img",m);t.setAttribute("src",e)});p.innerHTML=r+"<a href='"+t+"' download='file.png'>Скачать все файлы</a>"}}g.innerHTML=a.text,a.read?c.setAttribute("style","opacity: 0"):c.setAttribute("style","opacity: 1"),"Регистрации"==a.flag&&s.setAttribute("src","media/Cat_Registration.png"),"Штрафы и налоги"==a.flag&&s.setAttribute("src","media/Cat_Pay.png"),"Заказы"==a.flag&&s.setAttribute("src","media/Cat_Orders.png"),"Финансы"==a.flag&&s.setAttribute("src","media/Cat_Finance.png"),"Путешествия"==a.flag&&s.setAttribute("src","media/Cat_Travel.png"),"Билеты"==a.flag&&s.setAttribute("src","media/Cat_Tickets.png"),a.flag?i.innerHTML=a.flag:(i.innerHTML="",s.setAttribute("src",""))}}}function renderFolder(e){setBackButtonEnabled(!1),primary.setAttribute("style","opacity: 0"),last_folder=e;http.open("GET","/api/get_folder_emails/"+e);http.send(),http.onreadystatechange=function(){if(4==this.readyState&&200==this.status){setTimeout(()=>{primary.setAttribute("style","opacity: 1")},500);const e=JSON.parse(http.response);list.innerHTML="",e.forEach(e=>renderListItem(e)),setupCheckboxes()}}}function setupCheckboxes(){const e=document.querySelectorAll(".checkbox");e.forEach(e=>{e.addEventListener("click",()=>{e.parentElement.classList.contains("checked")?e.parentElement.classList.remove("checked"):e.parentElement.classList.add("checked")})})}function rusToLat(e){let t={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"j","з":"z","и":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"shch","ы":"y","э":"e","ю":"u","я":"ya","ъ":"ie","ь":"","й":"i"};return[...e].map(e=>{let r=t[e.toLocaleLowerCase()];return e!==e.toLocaleLowerCase()?r=r.charAt(0).toLocaleUpperCase()+r.slice(1):void 0===r&&(r=e),r}).join("")}const main=document.querySelector("main"),sidebar=document.querySelector("#sidebar"),primary=document.querySelector(".primary"),list=document.querySelector("#list"),viewer=document.querySelector("#viewer"),http=new XMLHttpRequest,sidebar_buttons=document.querySelectorAll("#folders > button");var last_folder=null;const backButton=document.querySelector("#corner-content_2");backButton.addEventListener("click",()=>{renderFolder(last_folder)}),sidebar_buttons.forEach(e=>{e.addEventListener("click",()=>{renderFolder(rusToLat(e.getAttribute("folder"))),sidebar_buttons.forEach(t=>{e===t?t.setAttribute("class","selected"):"white-button"!==e.className&&t.setAttribute("class","")})})}),renderFolder("Vhodyashchie");